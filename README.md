# ysda-celebrity-faces


# Общее описание системы
Сервис построен на основе двух docker-контейнеров, связываемых через http, так же написан рецепт для docker-compose.
В контейнере celebrity_faces находится веб-мордочка, скрипт для поиска лиц на залитой фотографии на основе предобученных каскадов Хаара (opencv) и нейронная сеть facenet, которая для каждого найденного лица считает 128-мерный эмбеддинг.
Во втором контейнере hnsw_index находится написанный на C++ HNSW индексер, метод поиска kNN которого проброшен в flask через cython-биндинг.

# Текущее состояние
В веб-форму можно залить произвольную фотографию из которой будут вырезаны распознанные лица, для каждого из которых будут найдены ближайшие соседи.

# Запланированные улучшения
Сделать более умный способ вырезания лиц, чтобы лица занимали ту же долю на изображении, что в обучающей выборке, иначе соседи получаются в основном по размеру лица на фотке, а не по внешней схожести, фотографии из датасета при этом получают правильных соседей.
Нужно провести серию экспериментов для оценки качества работы индексера, видимо стоит сравнить top-1, top-5, top-10 соседей на модельном датасете меньшего размера.
Если останется время, то планируем так же сделать GAN на основе найденного лица и ближайшего соседа, может быть потюним facenet.

# Использованные статьи и ресурсы
Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World graphs https://arxiv.org/abs/1603.09320
Face Recognition using Tensorflow https://github.com/davidsandberg/facenet
Face Detection using Haar Cascades https://docs.opencv.org/trunk/d7/d8b/tutorial_py_face_detection.html
Полное практическое руководство по Docker: с нуля до кластера на AWS https://habrahabr.ru/post/310460/

# Запуск
Клонируем репозиторий
```
git clone git@github.com:sgjurano/ysda-celebrity-faces.git
```
Скачиваем параметры для индексера, модель для подсчета эмбеддингов и датасет отсюда: https://yadi.sk/d/NkJaLhTS3UHBWd

Переходим в директорию репозитория и вызываем
```
docker-compose up
```

